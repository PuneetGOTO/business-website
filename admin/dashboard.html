<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>网站管理后台</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <style>
        body {
            background-color: #f8f9fa;
        }
        .sidebar {
            position: fixed;
            top: 0;
            bottom: 0;
            left: 0;
            z-index: 100;
            padding: 48px 0 0;
            box-shadow: inset -1px 0 0 rgba(0, 0, 0, .1);
            background-color: #343a40;
        }
        .sidebar-sticky {
            position: relative;
            top: 0;
            height: calc(100vh - 48px);
            padding-top: 0.5rem;
            overflow-x: hidden;
            overflow-y: auto;
        }
        .sidebar .nav-link {
            font-weight: 500;
            color: rgba(255, 255, 255, .5);
            padding: 0.5rem 1rem;
        }
        .sidebar .nav-link:hover {
            color: #fff;
        }
        .sidebar .nav-link.active {
            color: #fff;
            background-color: rgba(255, 255, 255, .1);
        }
        .sidebar .nav-link i {
            margin-right: 10px;
        }
        .navbar-brand {
            padding-top: .75rem;
            padding-bottom: .75rem;
            font-size: 1rem;
            background-color: rgba(0, 0, 0, .25);
            box-shadow: inset -1px 0 0 rgba(0, 0, 0, .25);
        }
        .navbar .form-control {
            padding: .75rem 1rem;
            border-width: 0;
            border-radius: 0;
        }
        .form-control-dark {
            color: #fff;
            background-color: rgba(255, 255, 255, .1);
            border-color: rgba(255, 255, 255, .1);
        }
        .form-control-dark:focus {
            border-color: transparent;
            box-shadow: 0 0 0 3px rgba(255, 255, 255, .25);
        }
        .section-editor {
            display: none;
        }
        .section-editor.active {
            display: block;
        }
        .success-message {
            display: none;
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            animation: fadeout 5s forwards;
        }
        @keyframes fadeout {
            0% { opacity: 1; }
            70% { opacity: 1; }
            100% { opacity: 0; }
        }
    </style>
    
    <!-- 临时修复：强制设置登录信息 -->
    <script>
        // 确保页面加载时设置登录状态
        sessionStorage.setItem('adminLoggedIn', 'true');
        sessionStorage.setItem('adminEmail', 'an920513@gmail.com');
        sessionStorage.setItem('adminToken', 'dummy-token-for-admin');
    </script>
</head>
<body>
    <nav class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0 shadow">
        <a class="navbar-brand col-md-3 col-lg-2 mr-0 px-3" href="#">网站管理后台</a>
        <button class="navbar-toggler position-absolute d-md-none collapsed" type="button" data-toggle="collapse" data-target="#sidebarMenu" aria-controls="sidebarMenu" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <ul class="navbar-nav px-3 ml-auto">
            <li class="nav-item text-nowrap">
                <a class="nav-link" href="#" id="logoutButton">登出</a>
            </li>
        </ul>
    </nav>

    <div class="container-fluid">
        <div class="row">
            <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block bg-dark sidebar collapse">
                <div class="sidebar-sticky pt-3">
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link active" href="#" data-section="home-section">
                                <i class="fas fa-home"></i> 首页管理
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-section="about-section">
                                <i class="fas fa-info-circle"></i> 关于我们
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-section="services-section">
                                <i class="fas fa-cogs"></i> 服务内容
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-section="portfolio-section">
                                <i class="fas fa-project-diagram"></i> 案例展示
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-section="team-section">
                                <i class="fas fa-users"></i> 团队成员
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-section="contact-section">
                                <i class="fas fa-envelope"></i> 联系方式
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>

            <main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-md-4 mt-4">
                <div class="alert alert-success success-message" id="successMessage">
                    修改已保存！
                </div>
                
                <!-- 首页管理 -->
                <div class="section-editor active" id="home-section">
                    <h2>首页管理</h2>
                    <div class="content-section">
                        <h3>快速修改导航</h3>
                        <div class="alert alert-info">
                            <strong>提示:</strong> 使用下方链接快速跳转到需要修改的内容，无需手动搜索。
                        </div>
                        
                        <div class="card mb-4">
                            <div class="card-header bg-primary text-white">
                                <h5 class="mb-0">首页内容</h5>
                            </div>
                            <div class="card-body">
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="list-group">
                                            <a href="#homeHeaderForm" class="list-group-item list-group-item-action">
                                                <i class="fa fa-edit"></i> 首页标题与描述
                                            </a>
                                            <a href="#featuredServicesForm" class="list-group-item list-group-item-action">
                                                <i class="fa fa-edit"></i> 特色服务
                                            </a>
                                            <a href="#upcomingMatchesForm" class="list-group-item list-group-item-action">
                                                <i class="fa fa-edit"></i> 即将到来的比赛
                                            </a>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="list-group">
                                            <a href="#aboutForm" class="list-group-item list-group-item-action">
                                                <i class="fa fa-edit"></i> 关于我们内容
                                            </a>
                                            <a href="#servicesForm" class="list-group-item list-group-item-action">
                                                <i class="fa fa-edit"></i> 服务项目内容
                                            </a>
                                            <a href="#portfolioForm" class="list-group-item list-group-item-action">
                                                <i class="fa fa-edit"></i> 案例展示内容
                                            </a>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="list-group">
                                            <a href="#teamForm" class="list-group-item list-group-item-action">
                                                <i class="fa fa-edit"></i> 团队成员内容
                                            </a>
                                            <a href="#contactForm" class="list-group-item list-group-item-action">
                                                <i class="fa fa-edit"></i> 联系方式内容
                                            </a>
                                            <a href="#htmlEditorContainer" class="list-group-item list-group-item-action bg-warning text-dark">
                                                <i class="fa fa-code"></i> HTML直接编辑
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="content-section">
                        <h3>首页标题与描述</h3>
                        <form id="homeHeaderForm">
                            <div class="form-group">
                                <label for="homeTitle">首页标题 (支持HTML):</label>
                                <input type="text" class="form-control" id="homeTitle" name="title">
                            </div>
                            <div class="form-group">
                                <label for="homeDescription">首页描述 (支持HTML):</label>
                                <textarea class="form-control html-editor" id="homeDescription" name="description" rows="4"></textarea>
                                <small class="form-text text-muted">可以使用HTML标签添加格式，例如：&lt;strong&gt;粗体文本&lt;/strong&gt;, &lt;em&gt;斜体文本&lt;/em&gt;, &lt;a href="..."&gt;链接&lt;/a&gt;</small>
                            </div>
                            <button type="submit" class="btn btn-primary">保存修改</button>
                        </form>
                    </div>
                    
                    <div class="content-section">
                        <h3>特色游戏</h3>
                        <form id="featuredServicesForm">
                            <div class="form-group">
                                <label for="game1Title">游戏1标题 (支持HTML):</label>
                                <input type="text" class="form-control" id="game1Title" name="service1Title">
                            </div>
                            <div class="form-group">
                                <label for="game1Description">游戏1描述 (支持HTML):</label>
                                <textarea class="form-control html-editor" id="game1Description" name="service1Description" rows="3"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="game1Icon">游戏1图标类名 (例如: fa-gamepad):</label>
                                <input type="text" class="form-control" id="game1Icon" name="service1Icon">
                            </div>
                            
                            <div class="form-group">
                                <label for="game2Title">游戏2标题 (支持HTML):</label>
                                <input type="text" class="form-control" id="game2Title" name="service2Title">
                            </div>
                            <div class="form-group">
                                <label for="game2Description">游戏2描述 (支持HTML):</label>
                                <textarea class="form-control html-editor" id="game2Description" name="service2Description" rows="3"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="game2Icon">游戏2图标类名 (例如: fa-gamepad):</label>
                                <input type="text" class="form-control" id="game2Icon" name="service2Icon">
                            </div>
                            
                            <div class="form-group">
                                <label for="game3Title">游戏3标题 (支持HTML):</label>
                                <input type="text" class="form-control" id="game3Title" name="service3Title">
                            </div>
                            <div class="form-group">
                                <label for="game3Description">游戏3描述 (支持HTML):</label>
                                <textarea class="form-control html-editor" id="game3Description" name="service3Description" rows="3"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="game3Icon">游戏3图标类名 (例如: fa-gamepad):</label>
                                <input type="text" class="form-control" id="game3Icon" name="service3Icon">
                            </div>
                            
                            <button type="submit" class="btn btn-primary">保存修改</button>
                        </form>
                    </div>
                    
                    <div class="content-section">
                        <h3>即将到来的比赛</h3>
                        <form id="upcomingMatchesForm">
                            <div class="form-group">
                                <label for="match1Teams">比赛1队伍 (支持HTML):</label>
                                <input type="text" class="form-control" id="match1Teams" name="match1Teams">
                            </div>
                            <div class="form-group">
                                <label for="match1Date">比赛1日期:</label>
                                <input type="text" class="form-control" id="match1Date" name="match1Date">
                            </div>
                            <div class="form-group">
                                <label for="match1Time">比赛1时间:</label>
                                <input type="text" class="form-control" id="match1Time" name="match1Time">
                            </div>
                            <div class="form-group">
                                <label for="match1Groups">比赛1分组:</label>
                                <input type="text" class="form-control" id="match1Groups" name="match1Groups">
                            </div>
                            <div class="form-group">
                                <label for="match1Players">比赛1玩家数:</label>
                                <input type="text" class="form-control" id="match1Players" name="match1Players">
                            </div>
                            <div class="form-group">
                                <label for="match1PrizePool">比赛1奖池:</label>
                                <input type="text" class="form-control" id="match1PrizePool" name="match1PrizePool">
                            </div>
                            
                            <div class="form-group">
                                <label for="match2Teams">比赛2队伍 (支持HTML):</label>
                                <input type="text" class="form-control" id="match2Teams" name="match2Teams">
                            </div>
                            <div class="form-group">
                                <label for="match2Date">比赛2日期:</label>
                                <input type="text" class="form-control" id="match2Date" name="match2Date">
                            </div>
                            <div class="form-group">
                                <label for="match2Time">比赛2时间:</label>
                                <input type="text" class="form-control" id="match2Time" name="match2Time">
                            </div>
                            <div class="form-group">
                                <label for="match2Groups">比赛2分组:</label>
                                <input type="text" class="form-control" id="match2Groups" name="match2Groups">
                            </div>
                            <div class="form-group">
                                <label for="match2Players">比赛2玩家数:</label>
                                <input type="text" class="form-control" id="match2Players" name="match2Players">
                            </div>
                            <div class="form-group">
                                <label for="match2PrizePool">比赛2奖池:</label>
                                <input type="text" class="form-control" id="match2PrizePool" name="match2PrizePool">
                            </div>
                            
                            <button type="submit" class="btn btn-primary">保存修改</button>
                        </form>
                    </div>
                    
                    <div class="content-section">
                        <h3>直接HTML编辑</h3>
                        <div class="alert alert-warning">
                            <strong>注意:</strong> 直接编辑HTML代码可能会影响网站的布局和功能。请确保您了解HTML代码的结构后再进行修改。
                        </div>
                        <form id="htmlEditorForm">
                            <div class="form-group">
                                <label for="htmlFileSelect">选择要编辑的HTML文件:</label>
                                <select class="form-control" id="htmlFileSelect" name="htmlFile">
                                    <option value="index.html">首页 (index.html)</option>
                                    <option value="about.html">关于我们 (about.html)</option>
                                    <option value="games.html">游戏 (games.html)</option>
                                    <option value="gallery.html">图库 (gallery.html)</option>
                                    <option value="contact.html">联系我们 (contact.html)</option>
                                    <option value="match_detail.html">比赛详情 (match_detail.html)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <button type="button" id="loadHtmlBtn" class="btn btn-info">加载文件内容</button>
                            </div>
                            <div class="form-group" id="htmlEditorContainer" style="display: none;">
                                <label for="htmlEditor">HTML代码:</label>
                                <textarea class="form-control" id="htmlEditor" name="htmlContent" rows="15" style="font-family: monospace;"></textarea>
                                <small class="form-text text-muted">提示: 使用浏览器的搜索功能 (Ctrl+F) 在代码中查找需要修改的内容。</small>
                            </div>
                            <div class="form-group" id="htmlEditorActions" style="display: none;">
                                <button type="submit" class="btn btn-primary">保存HTML修改</button>
                                <button type="button" id="cancelHtmlEdit" class="btn btn-secondary">取消</button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <!-- 关于我们管理 -->
                <div class="section-editor" id="about-section">
                    <h2>关于我们</h2>
                    <div class="card">
                        <div class="card-header">
                            关于我们内容管理
                        </div>
                        <div class="card-body">
                            <form id="aboutForm">
                                <div class="form-group">
                                    <label for="aboutTitle">标题</label>
                                    <input type="text" class="form-control" id="aboutTitle" name="title" placeholder="输入关于我们的标题">
                                </div>
                                <div class="form-group">
                                    <label for="aboutDescription">详细介绍</label>
                                    <textarea class="form-control" id="aboutDescription" name="description" rows="5" placeholder="输入公司详细介绍"></textarea>
                                </div>
                                <div class="form-group">
                                    <label for="aboutImage">图片URL</label>
                                    <input type="text" class="form-control" id="aboutImage" name="imageUrl" placeholder="输入图片URL">
                                </div>
                                <button type="submit" class="btn btn-primary">保存修改</button>
                            </form>
                        </div>
                    </div>
                </div>
                
                <!-- 服务内容管理 -->
                <div class="section-editor" id="services-section">
                    <h2>服务内容</h2>
                    <div class="card">
                        <div class="card-header">
                            服务项目管理
                        </div>
                        <div class="card-body">
                            <form id="servicesForm">
                                <div class="form-group">
                                    <label for="servicesTitle">服务板块标题</label>
                                    <input type="text" class="form-control" id="servicesTitle" name="title" placeholder="输入服务板块的总标题">
                                </div>
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label>服务1</label>
                                            <input type="text" class="form-control mb-2" name="service1Title" placeholder="服务名称">
                                            <textarea class="form-control" name="service1Description" rows="3" placeholder="服务描述"></textarea>
                                            <input type="text" class="form-control mt-2" name="service1Icon" placeholder="图标类名 (例: fas fa-chart-line)">
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label>服务2</label>
                                            <input type="text" class="form-control mb-2" name="service2Title" placeholder="服务名称">
                                            <textarea class="form-control" name="service2Description" rows="3" placeholder="服务描述"></textarea>
                                            <input type="text" class="form-control mt-2" name="service2Icon" placeholder="图标类名 (例: fas fa-cog)">
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label>服务3</label>
                                            <input type="text" class="form-control mb-2" name="service3Title" placeholder="服务名称">
                                            <textarea class="form-control" name="service3Description" rows="3" placeholder="服务描述"></textarea>
                                            <input type="text" class="form-control mt-2" name="service3Icon" placeholder="图标类名 (例: fas fa-briefcase)">
                                        </div>
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-primary">保存修改</button>
                            </form>
                        </div>
                    </div>
                </div>
                
                <!-- 案例展示管理 -->
                <div class="section-editor" id="portfolio-section">
                    <h2>案例展示</h2>
                    <div class="card">
                        <div class="card-header">
                            案例板块管理
                        </div>
                        <div class="card-body">
                            <form id="portfolioForm">
                                <div class="form-group">
                                    <label for="portfolioTitle">案例板块标题</label>
                                    <input type="text" class="form-control" id="portfolioTitle" name="title" placeholder="输入案例板块的总标题">
                                </div>
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label>案例1</label>
                                            <input type="text" class="form-control mb-2" name="portfolio1Title" placeholder="案例名称">
                                            <input type="text" class="form-control mb-2" name="portfolio1ImageUrl" placeholder="案例图片URL">
                                            <textarea class="form-control" name="portfolio1Description" rows="2" placeholder="案例简短描述"></textarea>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label>案例2</label>
                                            <input type="text" class="form-control mb-2" name="portfolio2Title" placeholder="案例名称">
                                            <input type="text" class="form-control mb-2" name="portfolio2ImageUrl" placeholder="案例图片URL">
                                            <textarea class="form-control" name="portfolio2Description" rows="2" placeholder="案例简短描述"></textarea>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label>案例3</label>
                                            <input type="text" class="form-control mb-2" name="portfolio3Title" placeholder="案例名称">
                                            <input type="text" class="form-control mb-2" name="portfolio3ImageUrl" placeholder="案例图片URL">
                                            <textarea class="form-control" name="portfolio3Description" rows="2" placeholder="案例简短描述"></textarea>
                                        </div>
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-primary">保存修改</button>
                            </form>
                        </div>
                    </div>
                </div>
                
                <!-- 团队成员管理 -->
                <div class="section-editor" id="team-section">
                    <h2>团队成员</h2>
                    <div class="card">
                        <div class="card-header">
                            团队成员管理
                        </div>
                        <div class="card-body">
                            <form id="teamForm">
                                <div class="form-group">
                                    <label for="teamTitle">团队板块标题</label>
                                    <input type="text" class="form-control" id="teamTitle" name="title" placeholder="输入团队板块的总标题">
                                </div>
                                <div class="row">
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label>成员1</label>
                                            <input type="text" class="form-control mb-2" name="member1Name" placeholder="成员姓名">
                                            <input type="text" class="form-control mb-2" name="member1Position" placeholder="职位">
                                            <input type="text" class="form-control mb-2" name="member1ImageUrl" placeholder="成员照片URL">
                                            <textarea class="form-control" name="member1Bio" rows="2" placeholder="个人简介"></textarea>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label>成员2</label>
                                            <input type="text" class="form-control mb-2" name="member2Name" placeholder="成员姓名">
                                            <input type="text" class="form-control mb-2" name="member2Position" placeholder="职位">
                                            <input type="text" class="form-control mb-2" name="member2ImageUrl" placeholder="成员照片URL">
                                            <textarea class="form-control" name="member2Bio" rows="2" placeholder="个人简介"></textarea>
                                        </div>
                                    </div>
                                    <div class="col-md-4">
                                        <div class="form-group">
                                            <label>成员3</label>
                                            <input type="text" class="form-control mb-2" name="member3Name" placeholder="成员姓名">
                                            <input type="text" class="form-control mb-2" name="member3Position" placeholder="职位">
                                            <input type="text" class="form-control mb-2" name="member3ImageUrl" placeholder="成员照片URL">
                                            <textarea class="form-control" name="member3Bio" rows="2" placeholder="个人简介"></textarea>
                                        </div>
                                    </div>
                                </div>
                                <button type="submit" class="btn btn-primary">保存修改</button>
                            </form>
                        </div>
                    </div>
                </div>
                
                <!-- 联系方式管理 -->
                <div class="section-editor" id="contact-section">
                    <h2>联系方式</h2>
                    <div class="card">
                        <div class="card-header">
                            联系方式管理
                        </div>
                        <div class="card-body">
                            <form id="contactForm">
                                <div class="form-group">
                                    <label for="contactTitle">联系我们标题</label>
                                    <input type="text" class="form-control" id="contactTitle" name="title" placeholder="输入联系我们的标题">
                                </div>
                                <div class="form-group">
                                    <label for="contactAddress">公司地址</label>
                                    <input type="text" class="form-control" id="contactAddress" name="address" placeholder="输入公司地址">
                                </div>
                                <div class="form-group">
                                    <label for="contactPhone">联系电话</label>
                                    <input type="text" class="form-control" id="contactPhone" name="phone" placeholder="输入联系电话">
                                </div>
                                <div class="form-group">
                                    <label for="contactEmail">电子邮件</label>
                                    <input type="email" class="form-control" id="contactEmail" name="email" placeholder="输入电子邮件">
                                </div>
                                <div class="form-group">
                                    <label for="contactWeChat">微信公众号</label>
                                    <input type="text" class="form-control" id="contactWeChat" name="wechat" placeholder="输入微信公众号">
                                </div>
                                <button type="submit" class="btn btn-primary">保存修改</button>
                            </form>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 内联版本的admin.js,以解决重定向问题
        document.addEventListener('DOMContentLoaded', function() {
            console.log('管理后台页面已加载');
            
            // 确保已经登录
            const isLoggedIn = sessionStorage.getItem('adminLoggedIn');
            const adminEmail = sessionStorage.getItem('adminEmail');
            const token = sessionStorage.getItem('adminToken');
            
            console.log('登录状态:', { isLoggedIn, adminEmail, token });
            
            if (!isLoggedIn || adminEmail !== 'an920513@gmail.com') {
                console.log('未登录，重定向到登录页面');
                window.location.href = 'login.html';
                return;
            }
            
            // 清除所有相关数据并重新初始化 (临时调试)
            clearAndInitializeData();
            
            // 尝试从websiteContent加载所有内容
            // loadAllContent();
            
            // 初始化侧边栏点击事件
            const sidebarLinks = document.querySelectorAll('.nav-link[data-section]');
            sidebarLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // 移除所有链接的活动状态
                    sidebarLinks.forEach(l => l.classList.remove('active'));
                    
                    // 为当前点击的链接添加活动状态
                    this.classList.add('active');
                    
                    // 显示相应的内容区域
                    const sectionId = this.getAttribute('data-section');
                    showSection(sectionId);
                });
            });
            
            // 初始化表单提交
            const forms = document.querySelectorAll('form');
            forms.forEach(form => {
                form.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    // 收集表单数据
                    const formData = new FormData(this);
                    const data = {};
                    for(let [key, value] of formData.entries()) {
                        data[key] = value;
                    }
                    
                    // 保存数据
                    saveToLocalStorage(this.id, data);
                    
                    // 显示成功消息
                    showSuccessMessage();
                });
                
                // 不在这里加载数据，使用集中的loadAllContent方法
                // loadFromLocalStorage(form.id);
            });
            
            // 初始化退出按钮
            const logoutButton = document.getElementById('logoutButton');
            if(logoutButton) {
                logoutButton.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // 清除会话存储
                    sessionStorage.removeItem('adminLoggedIn');
                    sessionStorage.removeItem('adminEmail');
                    sessionStorage.removeItem('adminToken');
                    
                    // 重定向到登录页面
                    window.location.href = 'login.html';
                });
            }
            
            // 添加同步按钮
            const syncButton = document.createElement('button');
            syncButton.className = 'btn btn-success position-fixed';
            syncButton.style.bottom = '20px';
            syncButton.style.right = '20px';
            syncButton.style.zIndex = '1000';
            syncButton.innerHTML = '<i class="fas fa-sync"></i> 同步到前台';
            syncButton.addEventListener('click', syncToFrontend);
            document.body.appendChild(syncButton);
        });
        
        // 同步到前台网站
        function syncToFrontend() {
            try {
                // 获取所有保存的数据
                const allData = {};
                
                // 获取所有表单ID
                const formIds = [
                    'homeHeaderForm', 
                    'featuredServicesForm', 
                    'upcomingMatchesForm',
                    'aboutForm',
                    'servicesForm',
                    'portfolioForm',
                    'teamForm',
                    'contactForm'
                ];
                
                // 收集所有表单数据
                formIds.forEach(formId => {
                    const form = document.getElementById(formId);
                    if(form) {
                        // 收集表单数据
                        const formData = new FormData(form);
                        const data = {};
                        for(let [key, value] of formData.entries()) {
                            data[key] = value;
                        }
                        
                        // 保存到各自的localStorage
                        localStorage.setItem(formId, JSON.stringify(data));
                        
                        // 添加到总数据对象
                        allData[formId] = data;
                    } else {
                        const formData = localStorage.getItem(formId);
                        if(formData) {
                            allData[formId] = JSON.parse(formData);
                        }
                    }
                });
                
                // 保存到全局数据存储中
                localStorage.setItem('websiteContent', JSON.stringify(allData));
                console.log('保存的网站内容数据:', allData);
                
                // 创建更新前台的脚本
                const updateScript = document.createElement('script');
                updateScript.innerHTML = `
                    // 创建一个自定义事件，通知前台更新内容
                    const updateEvent = new CustomEvent('adminContentUpdated', {
                        detail: ${JSON.stringify(allData)}
                    });
                    
                    // 触发事件
                    window.dispatchEvent(updateEvent);
                    
                    // 如果在同一域名下，可以直接访问前台页面的localStorage
                    try {
                        // 保存到全局存储以便前台访问
                        localStorage.setItem('websiteContent', JSON.stringify(${JSON.stringify(allData)}));
                        console.log('前台内容更新成功');
                    } catch(e) {
                        console.error('保存到localStorage失败:', e);
                    }
                `;
                
                document.body.appendChild(updateScript);
                
                // 显示同步成功消息
                showSuccessMessage('内容已成功同步到前台网站！');
                console.log('内容已同步到前台:', allData);
                
                // 如果需要，这里可以添加AJAX请求发送数据到服务器
                /* 
                fetch('/api/content/update', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${sessionStorage.getItem('adminToken')}`
                    },
                    body: JSON.stringify(allData)
                })
                .then(response => response.json())
                .then(data => {
                    console.log('服务器响应:', data);
                    if(data.success) {
                        showSuccessMessage('内容已成功保存到服务器！');
                    } else {
                        console.error('服务器保存失败:', data.message);
                    }
                })
                .catch(error => {
                    console.error('API请求失败:', error);
                });
                */
                
            } catch(error) {
                console.error('同步到前台失败:', error);
                alert('同步失败，请查看控制台获取详细信息');
            }
        }
        
        // 加载所有内容
        function loadAllContent() {
            console.log('开始加载所有内容...');
            
            // 先检查是否有"websiteContent"的数据
            const websiteContent = localStorage.getItem('websiteContent');
            if(websiteContent) {
                try {
                    const allData = JSON.parse(websiteContent);
                    console.log('从localStorage加载所有内容:', allData);
                    
                    // 加载所有表单数据
                    const formIds = [
                        'homeHeaderForm', 
                        'featuredServicesForm', 
                        'upcomingMatchesForm',
                        'aboutForm',
                        'servicesForm',
                        'portfolioForm',
                        'teamForm',
                        'contactForm'
                    ];
                    
                    formIds.forEach(formId => {
                        if(allData[formId]) {
                            console.log(`尝试加载 ${formId} 数据:`, allData[formId]);
                            loadFormData(formId, allData[formId]);
                        } else {
                            console.log(`没有找到 ${formId} 的数据`);
                            // 尝试直接从单独的localStorage项中获取
                            const singleFormData = localStorage.getItem(formId);
                            if(singleFormData) {
                                try {
                                    const data = JSON.parse(singleFormData);
                                    console.log(`从单独存储中找到 ${formId} 数据:`, data);
                                    loadFormData(formId, data);
                                } catch(e) {
                                    console.error(`解析 ${formId} 数据出错:`, e);
                                }
                            }
                        }
                    });
                } catch(e) {
                    console.error('解析网站内容数据出错:', e);
                }
            } else {
                console.log('没有找到websiteContent数据，尝试加载单独存储的表单数据');
                
                // 尝试直接加载各个表单数据
                const formIds = [
                    'homeHeaderForm', 
                    'featuredServicesForm', 
                    'upcomingMatchesForm',
                    'aboutForm',
                    'servicesForm',
                    'portfolioForm',
                    'teamForm',
                    'contactForm'
                ];
                
                formIds.forEach(formId => {
                    const formData = localStorage.getItem(formId);
                    if(formData) {
                        try {
                            const data = JSON.parse(formData);
                            console.log(`从单独存储中找到 ${formId} 数据:`, data);
                            loadFormData(formId, data);
                        } catch(e) {
                            console.error(`解析 ${formId} 数据出错:`, e);
                        }
                    } else {
                        console.log(`没有找到 ${formId} 的数据`);
                    }
                });
            }
            
            // 如果没有任何数据，初始化一些默认数据
            if(!localStorage.getItem('websiteContent') && !localStorage.getItem('homeHeaderForm')) {
                console.log('没有找到任何数据，初始化默认数据');
                initializeDefaultData();
            }
        }
        
        // 将数据加载到表单中
        function loadFormData(formId, data) {
            const form = document.getElementById(formId);
            if(!form) {
                console.error(`找不到表单: ${formId}`);
                return;
            }
            
            console.log(`开始填充表单 ${formId}:`, data);
            
            // 填充表单字段
            for(let key in data) {
                // 尝试多种方式找到表单元素
                let input = form.querySelector(`[name="${key}"]`);
                if(!input) {
                    input = document.getElementById(key);
                }
                
                if(input) {
                    input.value = data[key];
                    console.log(`设置字段 ${key} = ${data[key]}`);
                } else {
                    console.warn(`表单 ${formId} 中未找到字段: ${key}`);
                }
            }
        }
        
        // 初始化默认数据
        function initializeDefaultData() {
            // 首页数据
            const homeData = {
                title: "Roblox The Strongest Battlegrounds Team",
                description: "这里你可以找到你想加入的The Strongest Battlegrounds团队，也可以找到你的游戏伙伴."
            };
            localStorage.setItem('homeHeaderForm', JSON.stringify(homeData));
            
            // 特色游戏
            const gamesData = {
                service1Title: "Roblox",
                service1Description: "Roblox是一个全球性的在线游戏平台和创作系统，允许用户编程游戏和在3D环境中与他人玩游戏。",
                service1Icon: "fa-gamepad",
                service2Title: "待添加",
                service2Description: "游戏介绍待添加",
                service2Icon: "fa-gamepad",
                service3Title: "待添加",
                service3Description: "游戏介绍待添加",
                service3Icon: "fa-gamepad"
            };
            localStorage.setItem('featuredServicesForm', JSON.stringify(gamesData));
            
            // 关于我们
            const aboutData = {
                title: "关于我们",
                description: "我们是一支专业的Roblox The Strongest Battlegrounds游戏团队，致力于在游戏中创造最佳体验并帮助玩家提升技能。"
            };
            localStorage.setItem('aboutForm', JSON.stringify(aboutData));
            
            // 联系方式
            const contactData = {
                title: "联系我们",
                address: "游戏内工会: TSB公会总部",
                phone: "Discord: TSB#1234",
                email: "contact@tsbteam.com"
            };
            localStorage.setItem('contactForm', JSON.stringify(contactData));
            
            // 即将到来的比赛
            const matchesData = {
                match1Teams: "TSB vs. Wolves",
                match1Date: "2025年4月15日",
                match1Time: "19:00 CST",
                match1Groups: "A组",
                match1Players: "10人",
                match1PrizePool: "1000金币",
                match2Teams: "TSB vs. 黄金战士",
                match2Date: "2025年4月20日",
                match2Time: "20:00 CST",
                match2Groups: "B组",
                match2Players: "12人",
                match2PrizePool: "1500金币"
            };
            localStorage.setItem('upcomingMatchesForm', JSON.stringify(matchesData));
            
            // 通知用户
            alert('已初始化默认数据');
            
            // 重新加载表单数据
            loadAllContent();
        }
        
        // 显示指定的内容区域
        function showSection(sectionId) {
            // 隐藏所有内容区域
            const sections = document.querySelectorAll('.section-editor');
            sections.forEach(section => section.classList.remove('active'));
            
            // 显示指定的内容区域
            const targetSection = document.getElementById(sectionId);
            if(targetSection) {
                targetSection.classList.add('active');
            }
        }
        
        // 保存数据到本地存储
        function saveToLocalStorage(key, data) {
            localStorage.setItem(key, JSON.stringify(data));
        }
        
        // 显示成功消息
        function showSuccessMessage(message = '修改已保存！') {
            const successMessage = document.getElementById('successMessage');
            if(successMessage) {
                successMessage.style.display = 'block';
                successMessage.innerText = message;
                // 5秒后隐藏消息
                setTimeout(() => {
                    successMessage.style.display = 'none';
                }, 5000);
            }
        }
        
        // 清除并重新初始化数据
        function clearAndInitializeData() {
            // 清除所有相关数据
            localStorage.removeItem('websiteContent');
            localStorage.removeItem('homeHeaderForm');
            localStorage.removeItem('featuredServicesForm');
            localStorage.removeItem('upcomingMatchesForm');
            localStorage.removeItem('aboutForm');
            localStorage.removeItem('servicesForm');
            localStorage.removeItem('portfolioForm');
            localStorage.removeItem('teamForm');
            localStorage.removeItem('contactForm');
            
            // 重新初始化数据
            initializeDefaultData();
        }
    </script>
    
    <script>
        $(document).ready(function() {
            // 加载内容到表单
            loadAllContent();
            
            // 使用bootstrap工具提示
            $('[data-toggle="tooltip"]').tooltip();
            
            // 显示选中的内容编辑区域
            $('.sidebar .nav-link').on('click', function(e) {
                e.preventDefault();
                const targetSection = $(this).data('section');
                $('.section-editor').removeClass('active');
                $(`#${targetSection}`).addClass('active');
            });
            
            // 表单提交处理
            $('form').on('submit', function(e) {
                e.preventDefault();
                const formId = $(this).attr('id');
                saveFormData(formId, this);
            });
            
            // HTML文件编辑功能
            $('#loadHtmlBtn').on('click', function() {
                const selectedFile = $('#htmlFileSelect').val();
                if (!selectedFile) {
                    alert("请选择要编辑的HTML文件");
                    return;
                }
                
                // 显示加载中提示
                $(this).html('<span class="spinner-border spinner-border-sm"></span> 加载中...');
                $(this).prop('disabled', true);
                
                // 发送AJAX请求获取文件内容
                $.ajax({
                    url: '/api/content/html',
                    type: 'GET',
                    data: { file: selectedFile },
                    success: function(response) {
                        if (response.success) {
                            // 显示HTML编辑器并填充内容
                            $('#htmlEditor').val(response.content);
                            $('#htmlEditorContainer').show();
                            $('#htmlEditorActions').show();
                            
                            // 滚动到编辑器
                            $('html, body').animate({
                                scrollTop: $('#htmlEditorContainer').offset().top - 100
                            }, 500);
                        } else {
                            alert('无法加载文件: ' + response.message);
                        }
                    },
                    error: function(xhr, status, error) {
                        alert('加载文件失败: ' + error);
                        console.error('加载HTML文件失败:', error);
                    },
                    complete: function() {
                        // 恢复按钮状态
                        $('#loadHtmlBtn').html('加载文件内容');
                        $('#loadHtmlBtn').prop('disabled', false);
                    }
                });
            });
            
            // 保存HTML修改
            $('#htmlEditorForm').on('submit', function(e) {
                e.preventDefault();
                const selectedFile = $('#htmlFileSelect').val();
                const htmlContent = $('#htmlEditor').val();
                
                if (!selectedFile || !htmlContent) {
                    alert("请选择文件并确保有内容");
                    return;
                }
                
                // 禁用提交按钮防止重复提交
                const submitBtn = $(this).find('button[type="submit"]');
                const originalBtnText = submitBtn.html();
                submitBtn.html('<span class="spinner-border spinner-border-sm"></span> 保存中...');
                submitBtn.prop('disabled', true);
                
                // 发送AJAX请求保存文件内容
                $.ajax({
                    url: '/api/content/html',
                    type: 'POST',
                    data: { 
                        file: selectedFile,
                        content: htmlContent
                    },
                    success: function(response) {
                        if (response.success) {
                            // 显示成功消息
                            $('#successMessage').fadeIn().delay(3000).fadeOut();
                            
                            // 同步到前台
                            syncContentToFrontend();
                        } else {
                            alert('保存失败: ' + response.message);
                        }
                    },
                    error: function(xhr, status, error) {
                        alert('保存失败: ' + error);
                        console.error('保存HTML文件失败:', error);
                    },
                    complete: function() {
                        // 恢复按钮状态
                        submitBtn.html(originalBtnText);
                        submitBtn.prop('disabled', false);
                    }
                });
            });
            
            // 取消HTML编辑
            $('#cancelHtmlEdit').on('click', function() {
                $('#htmlEditor').val('');
                $('#htmlEditorContainer').hide();
                $('#htmlEditorActions').hide();
            });
        });
    </script>
    
    <script>
        // 在文档加载完成后初始化HTML编辑器
        $(document).ready(function() {
            // 初始化所有带有html-editor类的文本域
            $('.html-editor').each(function() {
                // 这里可以集成富文本编辑器如TinyMCE、CKEditor或Quill
                // 示例: 添加简单的工具栏
                const $editor = $(this);
                const $toolbar = $('<div class="html-toolbar mt-2 mb-1"></div>');
                
                // 添加常用的HTML标签按钮
                $toolbar.append('<button type="button" class="btn btn-sm btn-outline-secondary mr-1" data-tag="strong">粗体</button>');
                $toolbar.append('<button type="button" class="btn btn-sm btn-outline-secondary mr-1" data-tag="em">斜体</button>');
                $toolbar.append('<button type="button" class="btn btn-sm btn-outline-secondary mr-1" data-tag="u">下划线</button>');
                $toolbar.append('<button type="button" class="btn btn-sm btn-outline-secondary mr-1" data-tag="a" data-prompt="请输入链接URL:">链接</button>');
                $toolbar.append('<button type="button" class="btn btn-sm btn-outline-secondary mr-1" data-tag="br">换行</button>');
                
                // 将工具栏插入到文本域之前
                $editor.before($toolbar);
                
                // 为按钮添加事件处理
                $toolbar.find('button').on('click', function(e) {
                    e.preventDefault();
                    
                    const tag = $(this).data('tag');
                    const textarea = $editor.get(0);
                    const start = textarea.selectionStart;
                    const end = textarea.selectionEnd;
                    const selectedText = textarea.value.substring(start, end);
                    
                    let insertText = '';
                    
                    if (tag === 'a') {
                        const url = prompt($(this).data('prompt') || '请输入URL:');
                        if (url) {
                            insertText = `<a href="${url}">${selectedText || '链接文本'}</a>`;
                        } else {
                            return; // 用户取消了输入
                        }
                    } else if (tag === 'br') {
                        insertText = '<br>';
                    } else {
                        insertText = `<${tag}>${selectedText}</${tag}>`;
                    }
                    
                    // 插入标签
                    textarea.focus();
                    
                    // 现代浏览器
                    if (typeof textarea.setRangeText === 'function') {
                        textarea.setRangeText(insertText);
                        textarea.selectionStart = start + insertText.length;
                        textarea.selectionEnd = start + insertText.length;
                    } else {
                        // 向后兼容
                        const newValue = textarea.value.substring(0, start) + insertText + textarea.value.substring(end);
                        textarea.value = newValue;
                    }
                    
                    // 触发change事件以便可能的监听器知道内容已更改
                    $(textarea).trigger('change');
                });
            });
        });
    </script>
</body>
</html>
